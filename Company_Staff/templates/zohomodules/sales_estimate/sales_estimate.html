{% extends 'base.html' %}
{% block content %}
{% load static %}

<style>
  #searchInput {
      background-color: white;
      color: black;
      border: 1px solid orange;
  }
</style>


<body>

    <div class="body-wrapper">
        <div class="container-fluid">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a {% if login_d.user_type == 'Company' %} href="{% url 'company_dashboard' %}" {% else %} href="{% url 'staff_dashboard' %}" {% endif %} class="text-warning-emphasis">Dashboard</a></li>
              <li class="breadcrumb-item" aria-current="page">Estimate</li>
            </ol>
          </nav>

          <div style="overflow-x:auto;background-color: black;border-radius: 10px;" class="m-3 p-5"> 
            <h1 class="text-center text-white">All Estimates</h1>
            <div class="table-responsive">
              <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <input type="text" id="searchInput" placeholder="Search..." class="form-control mr-2 m-2 ">
                    <button class="btn btn-outline-warning dropdown-toggle text-yellow mr-2 m-2" type="button" id="sortButton2" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-sort"></i>
                    </button>
                    <ul class="dropdown-menu mr-2 m-2" id="dropdown-menu2" aria-labelledby="sortButton2">
                        <li><a class="dropdown-item" id="dropdown-itemsort" href="#" data-sort="all">All</a></li>
                        <li><a class="dropdown-item" id="dropdown-itemsort" href="#" data-sort="month">Name</a></li>
                        <li><a class="dropdown-item" id="dropdown-itemsort" href="#" data-sort="year">EST No</a></li>
                    </ul>
                </div>
                <div>
                  <button class="btn btn-outline-warning dropdown-toggle mr-2 text-yellow m-2"><i class="fa fa-filter"></i></button>
                  <button class="btn btn-outline-warning mr-2 text-yellow m-2"><i class="fa fa-file-export"></i>Export</button>
                  <button class="btn btn-outline-warning mr-2 text-yellow m-2"><i class="fa fa-file-import"></i> Import </button>
                  <a href="{% url 'sales_estimate_new' %}" class="btn btn-outline-warning text-yellow m-2"><i class="fa fa-plus text-yellow"></i>New</a>
                </div>
              </div>

              <table class="table mt-lg-3 rounded" style="color: white;" id="myTable">
                <thead>
                  <tr class="border-bottom border-dark">
                    <th scope="col" ><b>Sl. No</b></th>
                    <th scope="col" ><b>Date</b></th>
                    <th scope="col" ><b>Estimate Number</b></th>
                    <th scope="col" ><b>Customer Name</b></th>
                    <th scope="col" ><b>Customer Mail ID</b></th>
                    <th scope="col" ><b>Amount</b></th>
                    <th scope="col" ><b>Status</b></th>
                    <th scope="col" ><b>Balance</b></th>
                    <th scope="col" ><b>Action</b></th>
                  </tr>
                </thead>
                <tbody>
                  {% for est in estimate %}
                  <tr class="border-bottom border-dark" onclick="window.location.href=`{% url 'sales_estimate_overview' est.id %}`">
                    <td>{{forloop.counter}}</td>
                    <td>{{est.estimate_date}}</td>
                    <td>{{est.estimate_number}}</td>
                    <td>{{est.customer.customer_display_name}}</td>
                    <td>{{est.customer_email}}</td>
                    <td>{{est.grand_total}}</td>
                    <td>{{est.status}}</td>
                    <td></td>
                    <td></td>
                    </a>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>



            </div>





          </div>
</body>

<script>
  // Get the input field and table rows
  var input = document.getElementById("searchInput");
  var tableRows = document.querySelectorAll("#myTable tbody tr");

  // Add event listener to the search input
  input.addEventListener("input", function() {
      var filter = input.value.toLowerCase();
      // Loop through all table rows and hide those that don't match the search query
      tableRows.forEach(function(row) {
          var rowData = row.textContent.toLowerCase();
          if (rowData.includes(filter)) {
              row.style.display = "";
          } else {
              row.style.display = "none";
          }
      });
  });




  // Get the sort dropdown and table body
  var sortDropdown = document.getElementById("dropdown-menu2");
    var tableBody = document.querySelector("#myTable tbody");

    // Add event listener to the sort dropdown
    sortDropdown.addEventListener("click", function(event) {
        var target = event.target;
        if (target && target.tagName === "A") {
            var sortOption = target.getAttribute("data-sort");
            if (sortOption === "all") {
                // Reload the page to reset the sorting
                window.location.reload();
            } else {
                sortTable(sortOption);
            }
        }
    });

    // Function to sort the table based on the selected option
    function sortTable(sortOption) {
        var rows = Array.from(tableBody.querySelectorAll("tr"));

        // Remove the header row from the sorting process
        var headerRow = rows.shift();

        rows.sort(function(row1, row2) {
            var value1 = row1.cells[getColumnIndex(sortOption)].textContent.trim();
            var value2 = row2.cells[getColumnIndex(sortOption)].textContent.trim();
            return value1.localeCompare(value2);
        });

        // Re-append the header row to the sorted rows array
        rows.unshift(headerRow);

        // Append sorted rows back to the table
        tableBody.innerHTML = '';
        rows.forEach(function(row) {
            tableBody.appendChild(row);
        });
    }

    // Function to get the index of the column based on the sort option
    function getColumnIndex(sortOption) {
        switch (sortOption) {
            case "name":
                return 3; // Index of Customer Name column
            case "est":
                return 2; // Index of EST No column
            default:
                return -1; // Default value
        }
    }
</script>







{% endblock %}